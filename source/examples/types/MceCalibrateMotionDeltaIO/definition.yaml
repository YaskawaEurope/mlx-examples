company: Yaskawa Europe GmbH
author: deGroot
comment: IO data for the MceCalibrateMotionDelta function
changelog:
  - version: 0.1.0
    date: 2022-03-22
    author: deGroot
    added:
      - first version
#   changed:
#   fixed:
#   deprecated:
#   removed:
#   security:
var:
  - name: nRobotNumber
  - name: bSystemReady

  - name: bCalibrate
    description: |
      *Used as input*

      Start calibration.
    type: BOOL
    default_value: "0"
    comment: |
      input: start calibration

  - name: bIdle
  # - name: bBusy
  - name: bCoasting

  - name: bJogBusy
    description: |
      *Used as output*

      Jog motion busy.
    type: BOOL
    comment: |
      output: jog motion busy

  - name: bDone
  - name: bError
  - name: nErrorCode

  - name: nCalibrationType
    description: |
      *Used as input*

      Type of calibration.

    type: USINT
    default_value: "0"
    comment: |
      input: type of calibration [0=axis, 1=TCP]
    legend:
      0: axis motion deltas
      1: TCP motion deltas

  - name: nMeasurement
    description: |
      *Used as output*

      Measurement per axis.

    type: USINT
    default_value: "0"
    comment: |
      output: measurement per axis [0=low speed, 1=high speed]
    legend:
      0: low speed
      1: high speed

  - name: nAxis
    description: |
      *Used as output*

      Axis which is being calibrated.

      ```iecst
      // nCalibrationType = 0 (axis motion)

      // angle in degrees
      [0]     // S axis
      [1]     // L axis
      [2]     // U axis
      [3]     // R axis
      [4]     // B axis
      [5]     // T axis
      ```

      ```iecst
      // nCalibrationType = 1 (TCP motion)

      // position in mm
      [0]     // X axis
      [1]     // Y axis
      [2]     // Z axis
      // angle in degrees
      [3]     // Rx axis
      [4]     // Ry axis
      [5]     // Rz axis
      ```
    type: USINT
    comment: |
      output: current axis

  - name: nDelta
    description: |
      *Used as output*

      Current motion delta [0.1 units].
    type: UINT
    comment: |
      output: current motion delta [0.1 units]

  - name: nSmCalibration
    description: |
      State machine 1: Handling the calibration of motion deltas.

    type: UINT
    default_value: "0"
    comment: "in/out: state machine 1: calibration"
    legend:
      "00": idle, not ready for start
      "10": ready for calibration
      "11": get properties
      "12": set properties
      "13": select tool
      "20": move to start position (axis)
      "21": jog axis forward
      "22": jog axis forward - coasting
      "25": jog axis reverse
      "26": jog axis reverse - coasting
      # "31": TODO jog TCP forward
      # "32": jog TCP forward - coasting
      # "35": jog TCP reverse
      # "36": jog TCP reverse - coasting
      "40": done
      "99": error

  - name: fActualSpeed
    description: |
      *Used as output*

      Actual speed as percentage.
      Depending on the [nCalibrationType](#ncalibrationtype)
      either the retrieved `MaxLinearSpeed / MaxAngularSpeed` or the
      specified maximum joint speeds are used for the conversion.

    type: REAL
    comment: |
      output: actual speed as percentage

  - name: aMaxAxisSpeeds
    description: |
      *Used as input*

      Maximum speed per axis in `deg/s or mm/s`.
      This information comes from the datasheet or from the configuration
      in the robot controller.

      This data is used for scaling the actual axis speed to a percentage.

    type: ARRAY [0..5] OF REAL
    comment: "input: max speed per axis from datasheet or config [deg/s or mm/s]"
    default_value: "[100, 100, 100, 100, 100, 100]"

  - name: stMotionDeltas
    description: |
      *Used as input and output*

      Before starting the calibration you need to **set** the speeds for the two
      measurements:

      - `fSpeedLo` - set speed for measurement at low speed
      - `fSpeedHi` - set speed for measurement at high speed

      During the calibration MceCalibrateMotionDelta will
      **store** the motion deltas:

      - `aDeltaLo` - determined deltas at low speed
      - `aDeltaHi` - determined deltas at high speed

    type: MceMotionDeltas
    comment: |
      input: speed setting,
      output: determined deltas
