author: Rioual
comment: Performed a trajectory stored in a PosTable
changelog:
  - version: 0.2.0
    date: 2024-02-29
    author: Rioual
    added:
      - Selection of the number of motion instances
      - Selection of aborting mode
    changed:
      - Variable renamed
      - Resetting with `bReset` input replaced by setting `bRun=False`
  - version: 0.1.0-beta
    date: 2024-02-12
    author: Rioual
    added:
      - "initial version"
var:
  - kind: in_out
    var:
      - name: io
        description: |
          Interface data for this function.

          Check the data type for more information.
        type: McePosTableIO
        comment: McePosTable IO variables
      - name: MLX
      - name: posTable
      - name: userFrames
        description: |
          A collection of *User Frames* used by the *PosTable*.
        type: MceUserFrames
        comment: User frame data
      - name: tools
        description: |
          A collection of *Tools* used by the *PosTable*.
        type: MceToolData
        comment: Tool data
  - kind: var
    var:
      - name: aMoveCmd
        type: ARRAY[0..QA_MAX] OF MceCmdStatus
        comment: Status signals of mapped move instruction
      - name: fbRobotMoveAxisAbsolute
        type: ARRAY[0..QA_MAX] OF MLxRobotMoveAxisAbsolute
        comment: Move to target absolute axis position using PTP motion.
      - name: fbRobotMoveLinearAbsolute
        type: ARRAY[0..QA_MAX] OF MLxRobotMoveLinearAbsolute
        comment: Move to target TCP position in straight-line motion.
      - name: fbRobotSelectTool
        type: ARRAY[0..QA_MAX] OF MLxRobotSelectTool
        comment: Select the tool
      - name: fbRobotSetUserFrame
        type: ARRAY[0..QA_MAX] OF MLxRobotSetUserFrame
        comment: Set the active User Frame for the Robot.
      - name: stStateMonitoringData
        type: MceStateMonitoringData
        comment: monitor the elapsed time of a state
      - name: aUseMoveType
        type: ARRAY[0..QA_MAX] OF SINT
        comment: Use linear motion for this mapped move
      - name: nInstanceNumber
        type: ARRAY[0..QA_MAX] OF INT
        comment: 0 for nSmPosTable=11, 1 for 12, and so on
      - name: nQA
        type: INT
        comment: allowed Queueing Amount; number of motions to queue (for smooth motion)
      - name: nUserFrameNr
        type: DINT
      - name: nToolNr
        type: DINT
      - name: nPosTableSize
      - name: aEnable
        type: ARRAY[0..QA_MAX] OF BOOL
        comment: Enable mapped move instruction
      - name: aChangeTool
        type: ARRAY[0..QA_MAX] OF BOOL
        comment: Change the tool for this mapped move
      - name: aChangeUserFrame
        type: ARRAY[0..QA_MAX] OF BOOL
        comment: Change the user frame for this mapped move
      - name: aOneShots
        type: ARRAY[0..QA_MAX+6] OF BOOL
        comment: Rising edge signals
      - name: aOsrEnable
        type: ARRAY[0..QA_MAX] OF BOOL
        comment: rising edge on aEnable
      - name: aOneShotsInterlock
        type: ARRAY[0..GVL.NR_OF_INTERLOCK_FLAGS] OF BOOL
        comment: falling edge memory for interlock flags
      - name: bLastEntry
        type: BOOL
        comment: Last entry in process
      - name: bFirstMove
      - name: bDefaultActionDone
        type: BOOL
        comment: Default action at standstill done
      - name: bOsrRun
        type: BOOL
        comment: rising edge on bRun
      - name: bOsfRun
        type: BOOL
        comment: falling edge on bRun
      - name: bOsrStep
        type: BOOL
        comment: rising edge on bStep
      - name: bOsrSystemReady
        type: BOOL
        comment: rising edge on bOsrSystemReady
      - name: bOsrReset
        type: BOOL
        comment: rising edge on bReset
      - name: bWaiting
        type: BOOL
        comment: wait for bStep
      - name: bStopEntry
        type: BOOL
        comment: Entry with robot standstill (Action > 0) in process
      - name: bOsrRecalcQA
        type: BOOL
        comment: rising edge on bOsrRecalcQA
      - name: bError
        type: BOOL
        comment: Active when any MotoLogix FB is in error
      - name: bLastEntryInProcess
        type: BOOL
        comment: last motion of the PosTable is running
      - name: bOsfLastMoveInProcess
        type: BOOL
        comment: falling edge of bLastEntryInProcess
      - name: bAllowQueuing
        type: BOOL
        comment: Allow following motions to be queued
      - name: bStopAfterLastEntry
        type: BOOL
        comment: Stop PosTable after the last entry
      - name: bOsfInterlockFlag
        type: ARRAY[0..GVL.NR_OF_INTERLOCK_FLAGS] OF BOOL
        comment: falling edges of interlock flags
      - name: aOsrInterlockFlag
        type: ARRAY[0..GVL.NR_OF_INTERLOCK_FLAGS] OF BOOL
        comment: rising edges of interlock flags
      - name: aInterlockStop
        type: ARRAY[0..GVL.NR_OF_INTERLOCK_FLAGS] OF BOOL
        comment: interlock stop state. True if the robot can be stopped by interlock
  - kind: temp
    var:
      - name: i
      - name: k
      - name: bCustomActionDone
        type: BOOL
        comment: check if input bCustomActionDone correspond to the right custom ActionID
      - name: bUserFrameDone
        type: BOOL
        comment: UF has been loaded by MLxRobotSetUserFrame
      - name: bToolDone
        type: BOOL
        comment: Tool has been loaded by MLxRobotSelectTool
      - name: bUpdateQA
        type: BOOL
        comment: update queuing amount
  - kind: constant
    var:
      - name: QA_MAX
      - name: RESERVED_ACTIONID_UBOUND
        type: SINT
        default_value: 19
        comment: ActionID lower or equal to this value are reserved for default ActionID
      - name: PT_MODE_0
        type: SINT
        default_value: "0"
        commment: PosTable in continuous mode
      - name: PT_MODE_2
        type: SINT
        default_value: 2
        commment: PosTable in step-by-step mode
      - name: ACTIONID_NO_ACTION
        type: SINT
        default_value: "0"
        comment: no action
      - name: ACTIONID_WAIT_ONE_SCAN
        type: SINT
        default_value: 1
        comment: wait one PLC scan
      - name: ACTIONID_WAIT_STEP
        type: SINT
        default_value: 2
        comment: wait for rising edge on bStep